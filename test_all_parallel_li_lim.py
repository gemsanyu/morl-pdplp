import multiprocessing as mp
import subprocess

def test_proc(instance_name, num_vehicles, title, num_ray):
    process_args = ["python",
                    "test_phn.py",
                    "--test-instance-name",
                    instance_name,
                    "--test-num-vehicles",
                    str(num_vehicles),
                    "--title",
                    title,
                    "--num-ray",
                    str(num_ray)]
    subprocess.run(process_args)

def test_all_parallel(instances_list, title, num_ray):
    config_list = []
    for instance in instance_list:
        instance_name, num_vec = instance
        config_list += [[instance_name, num_vec, title, num_ray]]
    for config in config_list:
        test_proc(config[0], config[1], config[2], config[3])
#    with mp.Pool(20) as pool:
#        pool.starmap(test_proc, config_list)
    # for config in config_list:
    #     test(*config)

if __name__ == "__main__":
    title="moco-hnc-li_lim"
    num_ray=200

    instance_list = [
         ("lim_instances/LC101", 10),
        ("lim_instances/LC102", 10),
        ("lim_instances/LC103", 9),
        ("lim_instances/LC104", 9),
        ("lim_instances/LC105", 10),
        ("lim_instances/LC106", 10),
        ("lim_instances/LC107", 10),
        ("lim_instances/LC108", 10),
        ("lim_instances/LC109", 9),
        ("lim_instances/LC201", 3),
        ("lim_instances/LC202", 3),
        ("lim_instances/LC203", 3),
        ("lim_instances/LC204", 3),
        ("lim_instances/LC205", 3),
        ("lim_instances/LC206", 3),
        ("lim_instances/LC207", 3),
        ("lim_instances/LC208", 3),
        ("lim_instances/LR101", 19),
        ("lim_instances/LR102", 17),
        ("lim_instances/LR103", 13),
        ("lim_instances/LR104", 9),
        ("lim_instances/LR105", 14),
        ("lim_instances/LR106", 12),
        ("lim_instances/LR107", 10),
        ("lim_instances/LR108", 9),
        ("lim_instances/LR109", 11),
        ("lim_instances/LR110", 10),
        ("lim_instances/LR111", 10),
        ("lim_instances/LR112", 9),
        ("lim_instances/LR201", 4),
        ("lim_instances/LR202", 3),
        ("lim_instances/LR203", 3),
        ("lim_instances/LR204", 2),
        ("lim_instances/LR205", 3),
        ("lim_instances/LR206", 3),
        ("lim_instances/LR207", 2),
        ("lim_instances/LR208", 2),
        ("lim_instances/LR209", 3),
        ("lim_instances/LR210", 3),
        ("lim_instances/LR211", 2),
        ("lim_instances/LRC101", 14),
        ("lim_instances/LRC102", 12),
        ("lim_instances/LRC103", 11),
        ("lim_instances/LRC104", 10),
        ("lim_instances/LRC105", 13),
        ("lim_instances/LRC106", 11),
        ("lim_instances/LRC107", 11),
        ("lim_instances/LRC108", 10),
        ("lim_instances/LRC201", 4),
        ("lim_instances/LRC202", 3),
        ("lim_instances/LRC203", 3),
        ("lim_instances/LRC204", 3),
        ("lim_instances/LRC205", 4),
        ("lim_instances/LRC206", 3),
        ("lim_instances/LRC207", 3),
        ("lim_instances/LRC208", 3),
        ("lim_instances/LC1_2_1", 20),
        ("lim_instances/LC1_2_2", 19),
        ("lim_instances/LC1_2_3", 17),
        ("lim_instances/LC1_2_4", 17),
        ("lim_instances/LC1_2_5", 20),
        ("lim_instances/LC1_2_6", 20),
        ("lim_instances/LC1_2_7", 20),
        ("lim_instances/LC1_2_8", 19),
        ("lim_instances/LC1_2_9", 18),
        ("lim_instances/LC1_2_10", 17),
        ("lim_instances/LC2_2_1", 6),
        ("lim_instances/LC2_2_2", 6),
        ("lim_instances/LC2_2_3", 6),
        ("lim_instances/LC2_2_4", 6),
        ("lim_instances/LC2_2_5", 6),
        ("lim_instances/LC2_2_6", 6),
        ("lim_instances/LC2_2_7", 6),
        ("lim_instances/LC2_2_8", 6),
        ("lim_instances/LC2_2_9", 6),
        ("lim_instances/LC2_2_10", 6),
        ("lim_instances/LR1_2_1", 20),
        ("lim_instances/LR1_2_2", 17),
        ("lim_instances/LR1_2_3", 14),
        ("lim_instances/LR1_2_4", 10),
        ("lim_instances/LR1_2_5", 16),
        ("lim_instances/LR1_2_6", 13),
        ("lim_instances/LR1_2_7", 12),
        ("lim_instances/LR1_2_8", 9),
        ("lim_instances/LR1_2_9", 13),
        ("lim_instances/LR1_2_10", 11),
        ("lim_instances/LR2_2_1", 5),
        ("lim_instances/LR2_2_2", 4),
        ("lim_instances/LR2_2_3", 4),
        ("lim_instances/LR2_2_4", 3),
        ("lim_instances/LR2_2_5", 4),
        ("lim_instances/LR2_2_6", 3),
        ("lim_instances/LR2_2_7", 3),
        ("lim_instances/LR2_2_8", 2),
        ("lim_instances/LR2_2_9", 3),
        ("lim_instances/LR2_2_10", 3),
        ("lim_instances/LRC1_2_1", 19),
        ("lim_instances/LRC1_2_2", 15),
        ("lim_instances/LRC1_2_3", 13),
        ("lim_instances/LRC1_2_4", 10),
        ("lim_instances/LRC1_2_5", 16),
        ("lim_instances/LRC1_2_6", 16),
        ("lim_instances/LRC1_2_7", 14),
        ("lim_instances/LRC1_2_8", 13),
        ("lim_instances/LRC1_2_9", 13),
        ("lim_instances/LRC1_2_10", 12),
        ("lim_instances/LRC2_2_1", 6),
        ("lim_instances/LRC2_2_2", 5),
        ("lim_instances/LRC2_2_3", 4),
        ("lim_instances/LRC2_2_4", 3),
        ("lim_instances/LRC2_2_5", 5),
        ("lim_instances/LRC2_2_6", 5),
        ("lim_instances/LRC2_2_7", 4),
        ("lim_instances/LRC2_2_8", 4),
        ("lim_instances/LRC2_2_9", 4),
        ("lim_instances/LRC2_2_10", 3),
        ("lim_instances/LC1_4_1", 40),
        ("lim_instances/LC1_4_2", 38),
        ("lim_instances/LC1_4_3", 32),
        ("lim_instances/LC1_4_4", 30),
        ("lim_instances/LC1_4_5", 40),
        ("lim_instances/LC1_4_6", 40),
        ("lim_instances/LC1_4_7", 40),
        ("lim_instances/LC1_4_8", 38),
        ("lim_instances/LC1_4_9", 36),
        ("lim_instances/LC1_4_10", 34),
        ("lim_instances/LC2_4_1", 12),
        ("lim_instances/LC2_4_2", 12),
        ("lim_instances/LC2_4_3", 12),
        ("lim_instances/LC2_4_4", 12),
        ("lim_instances/LC2_4_5", 12),
        ("lim_instances/LC2_4_6", 12),
        ("lim_instances/LC2_4_7", 12),
        ("lim_instances/LC2_4_8", 12),
        ("lim_instances/LC2_4_9", 12),
        ("lim_instances/LC2_4_10", 12),
        ("lim_instances/LR1_4_1", 40),
        ("lim_instances/LR1_4_2", 30),
        ("lim_instances/LR1_4_3", 22),
        ("lim_instances/LR1_4_4", 15),
        ("lim_instances/LR1_4_5", 28),
        ("lim_instances/LR1_4_6", 23),
        ("lim_instances/LR1_4_7", 18),
        ("lim_instances/LR1_4_8", 13),
        ("lim_instances/LR1_4_9", 24),
        ("lim_instances/LR1_4_10", 20),
        ("lim_instances/LR2_4_1", 8),
        ("lim_instances/LR2_4_2", 7),
        ("lim_instances/LR2_4_3", 5),
        ("lim_instances/LR2_4_4", 4),
        ("lim_instances/LR2_4_5", 6),
        ("lim_instances/LR2_4_6", 5),
        ("lim_instances/LR2_4_7", 4),
        ("lim_instances/LR2_4_8", 4),
        ("lim_instances/LR2_4_9", 6),
        ("lim_instances/LR2_4_10", 5),
        ("lim_instances/LRC1_4_1", 36),
        ("lim_instances/LRC1_4_2", 31),
        ("lim_instances/LRC1_4_3", 24),
        ("lim_instances/LRC1_4_4", 19),
        ("lim_instances/LRC1_4_5", 32),
        ("lim_instances/LRC1_4_6", 30),
        ("lim_instances/LRC1_4_7", 28),
        ("lim_instances/LRC1_4_8", 26),
        ("lim_instances/LRC1_4_9", 25),
        ("lim_instances/LRC1_4_10", 23),
        ("lim_instances/LRC2_4_1", 11),
        ("lim_instances/LRC2_4_2", 10),
        ("lim_instances/LRC2_4_3", 8),
        ("lim_instances/LRC2_4_4", 5),
        ("lim_instances/LRC2_4_5", 10),
        ("lim_instances/LRC2_4_6", 9),
        ("lim_instances/LRC2_4_7", 8),
        ("lim_instances/LRC2_4_8", 7),
        ("lim_instances/LRC2_4_9", 6),
        ("lim_instances/LRC2_4_10", 6),
    ]
    test_all_parallel(instance_list, title, num_ray)
